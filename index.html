<!DOCTYPE html>
<html lang="bn">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MR_TOOLS - Admin Control Panel</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Poppins', sans-serif;
        }

        body {
            background: radial-gradient(circle at center, #1a0a0a, #000000);
            min-height: 100vh;
            padding: 20px;
            color: #e0e0e0;
            position: relative;
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
            padding: 20px;
            background: linear-gradient(145deg, #1a0a0a, #2a0a0a);
            border-radius: 20px;
            box-shadow: 0 15px 35px rgba(153, 0, 0, 0.6);
            border: 1px solid rgba(153, 0, 0, 0.7);
        }

        .header h1 {
            color: #ff6666;
            font-size: 32px;
            margin-bottom: 10px;
            text-shadow: 0 0 10px rgba(255, 102, 102, 0.7);
        }

        .stats-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 30px;
        }

        .stat-box {
            background: linear-gradient(145deg, #1a0a0a, #2a0a0a);
            padding: 20px;
            border-radius: 15px;
            text-align: center;
            border: 1px solid rgba(153, 0, 0, 0.5);
            box-shadow: 0 5px 15px rgba(153, 0, 0, 0.3);
            transition: transform 0.3s;
        }

        .stat-box:hover {
            transform: translateY(-5px);
        }

        .stat-number {
            font-size: 28px;
            font-weight: bold;
            color: #ff6666;
            margin-bottom: 5px;
        }

        .stat-label {
            font-size: 14px;
            color: #aaa;
        }

        .control-panel {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .panel-section {
            background: linear-gradient(145deg, #1a0a0a, #2a0a0a);
            padding: 25px;
            border-radius: 15px;
            border: 1px solid rgba(153, 0, 0, 0.5);
            box-shadow: 0 5px 15px rgba(153, 0, 0, 0.3);
        }

        .panel-section h2 {
            color: #ff6666;
            margin-bottom: 20px;
            font-size: 20px;
            border-bottom: 1px solid rgba(153, 0, 0, 0.5);
            padding-bottom: 10px;
        }

        .input-group {
            margin-bottom: 15px;
        }

        .input-group label {
            display: block;
            margin-bottom: 5px;
            color: #ff6666;
            font-weight: 600;
        }

        input, select, textarea {
            width: 100%;
            padding: 12px 15px;
            margin: 5px 0;
            border-radius: 12px;
            border: 1px solid #990000;
            font-size: 16px;
            background: rgba(20, 10, 10, 0.8);
            color: #e0e0e0;
        }

        input:focus, select:focus, textarea:focus {
            border-color: #ff6666;
            box-shadow: 0 0 15px rgba(255, 102, 102, 0.7);
            outline: none;
        }

        button {
            padding: 12px 20px;
            border: none;
            border-radius: 12px;
            background: linear-gradient(145deg, #990000, #cc0000);
            color: #fff;
            font-weight: 600;
            cursor: pointer;
            transition: 0.3s;
            font-size: 16px;
            margin: 5px;
        }

        button:hover {
            background: linear-gradient(145deg, #cc0000, #ff0000);
            transform: translateY(-2px);
        }

        .btn-block {
            background: linear-gradient(145deg, #990000, #cc0000);
        }

        .btn-unblock {
            background: linear-gradient(145deg, #006600, #009900);
        }

        .btn-send {
            background: linear-gradient(145deg, #000066, #000099);
        }

        .btn-refresh {
            background: linear-gradient(145deg, #006666, #009999);
        }

        .btn-copy {
            background: linear-gradient(145deg, #663300, #996600);
            padding: 8px 15px;
            font-size: 14px;
        }

        .btn-timer-block {
            background: linear-gradient(145deg, #993300, #cc6600);
        }

        .user-list {
            max-height: 400px;
            overflow-y: auto;
            margin: 10px 0;
            padding: 10px;
            background: rgba(30, 15, 15, 0.6);
            border-radius: 10px;
            border: 1px solid rgba(153, 0, 0, 0.3);
        }

        .user-item {
            padding: 15px;
            margin: 8px 0;
            background: rgba(50, 20, 20, 0.6);
            border-radius: 10px;
            border: 1px solid rgba(153, 0, 0, 0.4);
            transition: all 0.3s;
        }

        .user-item:hover {
            background: rgba(60, 25, 25, 0.8);
            transform: translateX(5px);
        }

        .user-info {
            flex: 1;
            text-align: left;
        }

        .user-id {
            font-weight: bold;
            color: #ff6666;
            margin-bottom: 5px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .user-details {
            font-size: 12px;
            color: #aaa;
        }

        .user-actions {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
            margin-top: 10px;
        }

        .status-badge {
            padding: 3px 8px;
            border-radius: 10px;
            font-size: 12px;
            font-weight: bold;
            margin-left: 10px;
        }

        .status-active {
            background: rgba(0, 153, 0, 0.3);
            color: #66ff66;
            border: 1px solid #66ff66;
        }

        .status-blocked {
            background: rgba(153, 0, 0, 0.3);
            color: #ff6666;
            border: 1px solid #ff6666;
        }

        .status-timer-blocked {
            background: rgba(153, 102, 0, 0.3);
            color: #ffcc66;
            border: 1px solid #ffcc66;
        }

        .alert {
            margin-top: 15px;
            font-weight: 600;
            font-size: 15px;
            color: #e0e0e0;
            padding: 10px;
            border-radius: 10px;
            text-align: center;
        }

        .alert-success {
            background: rgba(0, 153, 0, 0.2);
            border: 1px solid #66ff66;
            color: #66ff66;
        }

        .alert-error {
            background: rgba(153, 0, 0, 0.2);
            border: 1px solid #ff6666;
            color: #ff6666;
        }

        .alert-info {
            background: rgba(0, 102, 153, 0.2);
            border: 1px solid #66ccff;
            color: #66ccff;
        }

        .quick-actions {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin: 15px 0;
        }

        .quick-action-btn {
            flex: 1;
            min-width: 120px;
            padding: 10px;
            font-size: 14px;
        }

        .log-container {
            max-height: 300px;
            overflow-y: auto;
            background: rgba(20, 10, 10, 0.8);
            border-radius: 10px;
            padding: 15px;
            margin-top: 20px;
            border: 1px solid rgba(153, 0, 0, 0.3);
        }

        .log-entry {
            padding: 8px;
            margin: 5px 0;
            background: rgba(40, 20, 20, 0.6);
            border-radius: 5px;
            border-left: 3px solid #ff6666;
            font-size: 12px;
            color: #aaa;
        }

        .log-time {
            color: #ff6666;
            font-weight: bold;
        }

        .timer-control {
            display: flex;
            gap: 10px;
            margin-top: 10px;
        }

        .timer-input {
            flex: 1;
        }

        .copy-notification {
            position: fixed;
            top: 20px;
            right: 20px;
            background: rgba(0, 153, 0, 0.8);
            color: white;
            padding: 10px 20px;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.5);
            z-index: 1000;
            animation: slideInRight 0.3s, fadeOut 0.3s 1.7s forwards;
        }

        @keyframes slideInRight {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }

        @keyframes fadeOut {
            from { opacity: 1; }
            to { opacity: 0; }
        }

        .real-time-indicator {
            position: fixed;
            top: 10px;
            right: 10px;
            background: rgba(0, 153, 0, 0.8);
            color: white;
            padding: 5px 10px;
            border-radius: 15px;
            font-size: 12px;
            z-index: 1000;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.7; }
            100% { opacity: 1; }
        }

        .user-countdown {
            font-size: 11px;
            color: #ffcc66;
            margin-top: 3px;
        }

        .maintenance-message {
            background: rgba(153, 102, 0, 0.2);
            border: 1px solid #ffcc66;
            border-radius: 10px;
            padding: 15px;
            margin: 15px 0;
        }

        .message-templates {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 10px;
            margin: 15px 0;
        }

        .template-btn {
            background: linear-gradient(145deg, #006666, #009999);
            padding: 10px;
            font-size: 14px;
            text-align: center;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .broadcast-status {
            background: rgba(102, 0, 153, 0.2);
            border: 1px solid #cc66ff;
            border-radius: 10px;
            padding: 10px;
            margin: 10px 0;
            font-size: 14px;
        }

        @media (max-width: 768px) {
            .control-panel {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>

<div class="real-time-indicator" id="realTimeIndicator">
    <i class="fas fa-sync-alt"></i> ‡¶≤‡¶æ‡¶á‡¶≠ ‡¶Ü‡¶™‡¶°‡ßá‡¶ü
</div>

<div class="header">
    <h1>üõ°Ô∏è MR_TOOLS Admin Control Panel</h1>
    <p>‡¶∏‡¶¨ ‡¶á‡¶â‡¶ú‡¶æ‡¶∞ ‡¶∞‡¶ø‡¶Ø‡¶º‡ßá‡¶≤-‡¶ü‡¶æ‡¶á‡¶Æ‡ßá ‡¶ï‡¶®‡ßç‡¶ü‡ßç‡¶∞‡ßã‡¶≤ ‡¶ï‡¶∞‡ßÅ‡¶® - Multi Device Support</p>
</div>

<div class="stats-container">
    <div class="stat-box">
        <div class="stat-number" id="totalUsers">0</div>
        <div class="stat-label">‡¶Æ‡ßã‡¶ü ‡¶á‡¶â‡¶ú‡¶æ‡¶∞</div>
    </div>
    <div class="stat-box">
        <div class="stat-number" id="activeUsers">0</div>
        <div class="stat-label">‡¶è‡¶ï‡ßç‡¶ü‡¶ø‡¶≠ ‡¶á‡¶â‡¶ú‡¶æ‡¶∞</div>
    </div>
    <div class="stat-box">
        <div class="stat-number" id="blockedUsers">0</div>
        <div class="stat-label">‡¶¨‡ßç‡¶≤‡¶ï ‡¶á‡¶â‡¶ú‡¶æ‡¶∞</div>
    </div>
    <div class="stat-box">
        <div class="stat-number" id="totalOrders">0</div>
        <div class="stat-label">‡¶Æ‡ßã‡¶ü ‡¶Ö‡¶∞‡ßç‡¶°‡¶æ‡¶∞</div>
    </div>
</div>

<div class="control-panel">
    <!-- User Management Section -->
    <div class="panel-section">
        <h2>üë• ‡¶á‡¶â‡¶ú‡¶æ‡¶∞ ‡¶Æ‡ßç‡¶Ø‡¶æ‡¶®‡ßá‡¶ú‡¶Æ‡ßá‡¶®‡ßç‡¶ü</h2>
        
        <div class="input-group">
            <label>‡¶á‡¶â‡¶ú‡¶æ‡¶∞ ‡¶∏‡¶æ‡¶∞‡ßç‡¶ö</label>
            <input type="text" id="searchUser" placeholder="‡¶á‡¶â‡¶ú‡¶æ‡¶∞ ID ‡¶¨‡¶æ ‡¶®‡¶æ‡¶Æ ‡¶≤‡¶ø‡¶ñ‡ßÅ‡¶®...">
        </div>
        
        <button class="btn-refresh" onclick="loadUsers()">
            <i class="fas fa-sync-alt"></i> ‡¶á‡¶â‡¶ú‡¶æ‡¶∞ ‡¶≤‡¶ø‡¶∏‡ßç‡¶ü ‡¶∞‡¶ø‡¶´‡ßç‡¶∞‡ßá‡¶∂
        </button>
        
        <div class="user-list" id="userList">
            <div class="user-item">
                <div class="user-info">
                    <div class="user-id">‡¶≤‡ßã‡¶° ‡¶π‡¶ö‡ßç‡¶õ‡ßá...</div>
                </div>
            </div>
        </div>
    </div>

    <!-- Block/Unblock Section -->
    <div class="panel-section">
        <h2>üö´ ‡¶¨‡ßç‡¶≤‡¶ï/‡¶Ü‡¶®‡¶¨‡ßç‡¶≤‡¶ï ‡¶ï‡¶®‡ßç‡¶ü‡ßç‡¶∞‡ßã‡¶≤</h2>
        
        <div class="input-group">
            <label>‡¶á‡¶â‡¶ú‡¶æ‡¶∞ ID</label>
            <input type="text" id="blockUserId" placeholder="‡¶¨‡ßç‡¶≤‡¶ï/‡¶Ü‡¶®‡¶¨‡ßç‡¶≤‡¶ï ‡¶ï‡¶∞‡¶æ‡¶∞ ‡¶á‡¶â‡¶ú‡¶æ‡¶∞ ID">
        </div>
        
        <div class="input-group">
            <label>‡¶ü‡¶æ‡¶á‡¶Æ‡¶æ‡¶∞ ‡¶¨‡ßç‡¶≤‡¶ï (‡¶Æ‡¶ø‡¶®‡¶ø‡¶ü)</label>
            <div class="timer-control">
                <input type="number" id="blockMinutes" placeholder="‡¶Æ‡¶ø‡¶®‡¶ø‡¶ü" class="timer-input" min="1" max="1440">
                <button class="btn-timer-block" onclick="timerBlockUser()">
                    <i class="fas fa-clock"></i> ‡¶ü‡¶æ‡¶á‡¶Æ‡¶æ‡¶∞ ‡¶¨‡ßç‡¶≤‡¶ï
                </button>
            </div>
        </div>
        
        <div class="quick-actions">
            <button class="btn-block" onclick="blockUser()">
                <i class="fas fa-ban"></i> ‡¶™‡¶æ‡¶∞‡ßç‡¶Æ‡¶æ‡¶®‡ßá‡¶®‡ßç‡¶ü ‡¶¨‡ßç‡¶≤‡¶ï
            </button>
            <button class="btn-unblock" onclick="unblockUser()">
                <i class="fas fa-check"></i> ‡¶Ü‡¶®‡¶¨‡ßç‡¶≤‡¶ï
            </button>
        </div>
        
        <div class="input-group">
            <label>‡¶¶‡ßç‡¶∞‡ßÅ‡¶§ ‡¶è‡¶ï‡¶∂‡¶®</label>
            <div class="quick-actions">
                <button class="btn-block quick-action-btn" onclick="blockAllUsers()">
                    ‡¶∏‡¶¨‡¶æ‡¶á‡¶ï‡ßá ‡¶¨‡ßç‡¶≤‡¶ï ‡¶ï‡¶∞‡ßÅ‡¶®
                </button>
                <button class="btn-unblock quick-action-btn" onclick="unblockAllUsers()">
                    ‡¶∏‡¶¨‡¶æ‡¶á‡¶ï‡ßá ‡¶Ü‡¶®‡¶¨‡ßç‡¶≤‡¶ï ‡¶ï‡¶∞‡ßÅ‡¶®
                </button>
            </div>
        </div>
    </div>

    <!-- Message Control Section -->
    <div class="panel-section">
        <h2>üí¨ ‡¶Æ‡ßá‡¶∏‡ßá‡¶ú ‡¶ï‡¶®‡ßç‡¶ü‡ßç‡¶∞‡ßã‡¶≤</h2>
        
        <div class="maintenance-message">
            <h3><i class="fas fa-tools"></i> ‡¶Æ‡ßá‡¶á‡¶®‡ßç‡¶ü‡ßá‡¶®‡ßá‡¶®‡ßç‡¶∏ ‡¶Æ‡ßá‡¶∏‡ßá‡¶ú</h3>
            <p>‡¶è‡¶á ‡¶Æ‡ßá‡¶∏‡ßá‡¶ú ‡¶á‡¶â‡¶ú‡¶æ‡¶∞‡¶¶‡ßá‡¶∞ ‡¶ú‡¶æ‡¶®‡¶æ‡¶¨‡ßá ‡¶Ø‡ßá ‡¶∏‡¶ø‡¶∏‡ßç‡¶ü‡ßá‡¶Æ‡ßá ‡¶ï‡¶æ‡¶ú ‡¶ö‡¶≤‡¶õ‡ßá ‡¶è‡¶¨‡¶Ç ‡¶ï‡¶ø‡¶õ‡ßÅ‡¶ï‡ßç‡¶∑‡¶£‡ßá‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø ‡¶¨‡¶®‡ßç‡¶ß ‡¶•‡¶æ‡¶ï‡¶¨‡ßá</p>
        </div>
        
        <div class="input-group">
            <label>‡¶¨‡ßç‡¶∞‡¶°‡¶ï‡¶æ‡¶∏‡ßç‡¶ü ‡¶Æ‡ßá‡¶∏‡ßá‡¶ú (‡¶∏‡¶¨‡¶æ‡¶á‡¶ï‡ßá)</label>
            <textarea id="broadcastMessage" placeholder="‡¶∏‡¶¨ ‡¶á‡¶â‡¶ú‡¶æ‡¶∞‡¶ï‡ßá ‡¶Æ‡ßá‡¶∏‡ßá‡¶ú ‡¶≤‡¶ø‡¶ñ‡ßÅ‡¶®..." rows="3"></textarea>
        </div>
        
        <div class="message-templates">
            <div class="template-btn" onclick="setMaintenanceMessage('‡¶∏‡¶ø‡¶∏‡ßç‡¶ü‡ßá‡¶Æ ‡¶Ü‡¶™‡¶°‡ßá‡¶ü')">‡¶∏‡¶ø‡¶∏‡ßç‡¶ü‡ßá‡¶Æ ‡¶Ü‡¶™‡¶°‡ßá‡¶ü</div>
            <div class="template-btn" onclick="setMaintenanceMessage('‡¶∏‡¶æ‡¶∞‡ßç‡¶≠‡¶ø‡¶∏ ‡¶¨‡¶®‡ßç‡¶ß')">‡¶∏‡¶æ‡¶∞‡ßç‡¶≠‡¶ø‡¶∏ ‡¶¨‡¶®‡ßç‡¶ß</div>
            <div class="template-btn" onclick="setMaintenanceMessage('‡¶ï‡¶æ‡¶ú ‡¶ö‡¶≤‡¶õ‡ßá')">‡¶ï‡¶æ‡¶ú ‡¶ö‡¶≤‡¶õ‡ßá</div>
            <div class="template-btn" onclick="setMaintenanceMessage('‡¶Ö‡¶≤‡ßç‡¶™ ‡¶∏‡¶Æ‡¶Ø‡¶º‡ßá‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø ‡¶¨‡¶®‡ßç‡¶ß')">‡¶Ö‡¶≤‡ßç‡¶™ ‡¶∏‡¶Æ‡¶Ø‡¶º‡ßá‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø ‡¶¨‡¶®‡ßç‡¶ß</div>
        </div>
        
        <div class="broadcast-status">
            <h4>‡¶¨‡¶∞‡ßç‡¶§‡¶Æ‡¶æ‡¶® ‡¶¨‡ßç‡¶∞‡¶°‡¶ï‡¶æ‡¶∏‡ßç‡¶ü ‡¶∏‡ßç‡¶ü‡ßç‡¶Ø‡¶æ‡¶ü‡¶æ‡¶∏:</h4>
            <div id="currentBroadcast">‡¶ï‡ßã‡¶®‡ßã ‡¶è‡¶ï‡ßç‡¶ü‡¶ø‡¶≠ ‡¶¨‡ßç‡¶∞‡¶°‡¶ï‡¶æ‡¶∏‡ßç‡¶ü ‡¶®‡ßá‡¶á</div>
        </div>
        
        <div class="input-group">
            <label>‡¶™‡ßç‡¶∞‡¶æ‡¶á‡¶≠‡ßá‡¶ü ‡¶Æ‡ßá‡¶∏‡ßá‡¶ú</label>
            <input type="text" id="privateUserId" placeholder="‡¶á‡¶â‡¶ú‡¶æ‡¶∞ ID">
            <textarea id="privateMessage" placeholder="‡¶®‡¶ø‡¶∞‡ßç‡¶¶‡¶ø‡¶∑‡ßç‡¶ü ‡¶á‡¶â‡¶ú‡¶æ‡¶∞‡¶ï‡ßá ‡¶Æ‡ßá‡¶∏‡ßá‡¶ú ‡¶≤‡¶ø‡¶ñ‡ßÅ‡¶®..." rows="3"></textarea>
        </div>
        
        <div class="quick-actions">
            <button class="btn-send" onclick="sendBroadcastMessage()">
                <i class="fas fa-bullhorn"></i> ‡¶¨‡ßç‡¶∞‡¶°‡¶ï‡¶æ‡¶∏‡ßç‡¶ü ‡¶™‡¶æ‡¶†‡¶æ‡¶®
            </button>
            <button class="btn-send" onclick="sendPrivateMessage()">
                <i class="fas fa-envelope"></i> ‡¶™‡ßç‡¶∞‡¶æ‡¶á‡¶≠‡ßá‡¶ü ‡¶™‡¶æ‡¶†‡¶æ‡¶®
            </button>
        </div>
    </div>
</div>

<!-- Alert Box -->
<div class="alert" id="alertBox"></div>

<!-- Activity Log -->
<div class="panel-section">
    <h2>üìã ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶ï‡ßç‡¶ü‡¶ø‡¶≠‡¶ø‡¶ü‡¶ø ‡¶≤‡¶ó</h2>
    <button class="btn-refresh" onclick="clearLogs()">
        <i class="fas fa-trash"></i> ‡¶≤‡¶ó ‡¶ï‡ßç‡¶≤‡¶ø‡¶Ø‡¶º‡¶æ‡¶∞ ‡¶ï‡¶∞‡ßÅ‡¶®
    </button>
    <div class="log-container" id="logContainer">
        <div class="log-entry">
            <span class="log-time">[‡¶∏‡¶ø‡¶∏‡ßç‡¶ü‡ßá‡¶Æ]</span> ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶°‡¶Æ‡¶ø‡¶® ‡¶™‡ßç‡¶Ø‡¶æ‡¶®‡ßá‡¶≤ ‡¶ö‡¶æ‡¶≤‡ßÅ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá...
        </div>
    </div>
</div>

<script>
// Configuration - Same shared data system as user panel
const SHARED_DATA_KEY = 'mr_tools_global_data';
const ADMIN_LOGS_KEY = 'mr_tools_admin_logs';

// Global State
let adminLogs = JSON.parse(localStorage.getItem(ADMIN_LOGS_KEY) || '[]');

// Initialize logs
if (adminLogs.length === 0) {
    addLog('‡¶Ö‡ßç‡¶Ø‡¶æ‡¶°‡¶Æ‡¶ø‡¶® ‡¶™‡ßç‡¶Ø‡¶æ‡¶®‡ßá‡¶≤ ‡¶ö‡¶æ‡¶≤‡ßÅ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá');
}

// SHARED DATA SYSTEM FUNCTIONS
function getSharedData() {
    try {
        return JSON.parse(localStorage.getItem(SHARED_DATA_KEY)) || {
            users: {},
            blocks: {},
            messages: {},
            orders: {},
            settings: {},
            lastUpdated: Date.now()
        };
    } catch (e) {
        return {
            users: {},
            blocks: {},
            messages: {},
            orders: {},
            settings: {},
            lastUpdated: Date.now()
        };
    }
}

function saveSharedData(data) {
    data.lastUpdated = Date.now();
    localStorage.setItem(SHARED_DATA_KEY, JSON.stringify(data));
}

// Update statistics
function updateStatistics() {
    const sharedData = getSharedData();
    const users = Object.values(sharedData.users || {});
    const totalUsers = users.length;
    
    let activeUsers = 0;
    let blockedUsers = 0;
    let totalOrders = 0;

    users.forEach(user => {
        totalOrders += user.orders || 0;
        
        if (sharedData.blocks && sharedData.blocks[user.id]) {
            const blockData = sharedData.blocks[user.id];
            if (blockData.type === 'permanent') {
                blockedUsers++;
            } else if (blockData.type === 'temporary') {
                const currentTime = new Date().getTime();
                if (currentTime < blockData.blockTime + (blockData.duration * 60 * 1000)) {
                    blockedUsers++;
                }
            }
        } else {
            activeUsers++;
        }
    });

    document.getElementById('totalUsers').textContent = totalUsers;
    document.getElementById('activeUsers').textContent = activeUsers;
    document.getElementById('blockedUsers').textContent = blockedUsers;
    document.getElementById('totalOrders').textContent = totalOrders;
}

// Get remaining time for timer blocked users
function getRemainingTime(userId) {
    const sharedData = getSharedData();
    if (sharedData.blocks && sharedData.blocks[userId]) {
        const blockData = sharedData.blocks[userId];
        if (blockData.type === 'temporary') {
            const currentTime = new Date().getTime();
            const blockEndTime = blockData.blockTime + (blockData.duration * 60 * 1000);
            const remainingTime = blockEndTime - currentTime;
            
            if (remainingTime > 0) {
                const minutes = Math.floor(remainingTime / (60 * 1000));
                const seconds = Math.floor((remainingTime % (60 * 1000)) / 1000);
                return `${minutes}:${seconds.toString().padStart(2, '0')}`;
            } else {
                // Remove expired block
                delete sharedData.blocks[userId];
                saveSharedData(sharedData);
            }
        }
    }
    return null;
}

// Update broadcast status
function updateBroadcastStatus() {
    const sharedData = getSharedData();
    const broadcastStatus = document.getElementById('currentBroadcast');
    
    if (sharedData.messages && sharedData.messages['broadcast'] && sharedData.messages['broadcast'].length > 0) {
        const broadcasts = sharedData.messages['broadcast'];
        const latestBroadcast = broadcasts[broadcasts.length - 1];
        const time = new Date(latestBroadcast.timestamp).toLocaleString();
        broadcastStatus.innerHTML = `
            <strong>‡¶Æ‡ßá‡¶∏‡ßá‡¶ú:</strong> ${latestBroadcast.message.substring(0, 50)}...<br>
            <strong>‡¶∏‡¶Æ‡¶Ø‡¶º:</strong> ${time}<br>
            <strong>‡¶∏‡ßç‡¶ü‡ßç‡¶Ø‡¶æ‡¶ü‡¶æ‡¶∏:</strong> <span style="color:#66ff66">‡¶è‡¶ï‡ßç‡¶ü‡¶ø‡¶≠</span>
        `;
    } else {
        broadcastStatus.textContent = '‡¶ï‡ßã‡¶®‡ßã ‡¶è‡¶ï‡ßç‡¶ü‡¶ø‡¶≠ ‡¶¨‡ßç‡¶∞‡¶°‡¶ï‡¶æ‡¶∏‡ßç‡¶ü ‡¶®‡ßá‡¶á';
    }
}

// Load users list
function loadUsers() {
    const userList = document.getElementById('userList');
    const searchTerm = document.getElementById('searchUser').value.toLowerCase();
    
    const sharedData = getSharedData();
    let users = Object.values(sharedData.users || {});
    
    // Apply search filter
    if (searchTerm) {
        users = users.filter(user => 
            user.id.toLowerCase().includes(searchTerm) ||
            (user.platform && user.platform.toLowerCase().includes(searchTerm))
        );
    }
    
    userList.innerHTML = '';
    
    if (users.length === 0) {
        userList.innerHTML = '<div class="user-item"><div class="user-info">‡¶ï‡ßã‡¶® ‡¶á‡¶â‡¶ú‡¶æ‡¶∞ ‡¶ñ‡ßÅ‡¶Å‡¶ú‡ßá ‡¶™‡¶æ‡¶ì‡¶Ø‡¶º‡¶æ ‡¶Ø‡¶æ‡¶Ø‡¶º‡¶®‡¶ø</div></div>';
        return;
    }
    
    // Sort by last active (newest first)
    users.sort((a, b) => new Date(b.lastActive || 0) - new Date(a.lastActive || 0));
    
    users.forEach(user => {
        const isPermanentlyBlocked = sharedData.blocks && sharedData.blocks[user.id] && 
                                   sharedData.blocks[user.id].type === 'permanent';
        const isTimerBlocked = sharedData.blocks && sharedData.blocks[user.id] && 
                              sharedData.blocks[user.id].type === 'temporary';
        const remainingTime = getRemainingTime(user.id);
        
        let status = '‡¶è‡¶ï‡ßç‡¶ü‡¶ø‡¶≠';
        let statusClass = 'status-active';
        
        if (isPermanentlyBlocked) {
            status = '‡¶™‡¶æ‡¶∞‡ßç‡¶Æ‡¶æ‡¶®‡ßá‡¶®‡ßç‡¶ü ‡¶¨‡ßç‡¶≤‡¶ï';
            statusClass = 'status-blocked';
        } else if (isTimerBlocked && remainingTime) {
            status = '‡¶ü‡¶æ‡¶á‡¶Æ‡¶æ‡¶∞ ‡¶¨‡ßç‡¶≤‡¶ï';
            statusClass = 'status-timer-blocked';
        }
        
        const userItem = document.createElement('div');
        userItem.className = 'user-item';
        userItem.innerHTML = `
            <div class="user-info">
                <div class="user-id">
                    <span>${user.id}</span>
                    <button class="btn-copy" onclick="copyUserId('${user.id}')">
                        <i class="fas fa-copy"></i> ‡¶ï‡¶™‡¶ø
                    </button>
                    <span class="status-badge ${statusClass}">${status}</span>
                </div>
                <div class="user-details">
                    ‡¶Ö‡¶∞‡ßç‡¶°‡¶æ‡¶∞: ${user.orders || 0} | 
                    ‡¶∂‡ßá‡¶∑ ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶ï‡ßç‡¶ü‡¶ø‡¶≠: ${user.lastActive ? new Date(user.lastActive).toLocaleString() : '‡¶Ö‡¶ú‡¶æ‡¶®‡¶æ'} |
                    ‡¶°‡¶ø‡¶≠‡¶æ‡¶á‡¶∏: ${user.platform || '‡¶Ö‡¶ú‡¶æ‡¶®‡¶æ'}
                    ${isTimerBlocked && remainingTime ? 
                        `<div class="user-countdown">‡¶¨‡ßç‡¶≤‡¶ï ‡¶∂‡ßá‡¶∑: ${remainingTime}</div>` : ''}
                </div>
                <div class="user-actions">
                    <button class="btn-send" onclick="quickMessage('${user.id}')" title="‡¶Æ‡ßá‡¶∏‡ßá‡¶ú ‡¶™‡¶æ‡¶†‡¶æ‡¶®">
                        <i class="fas fa-comment"></i>
                    </button>
                    ${!isPermanentlyBlocked && !isTimerBlocked ? 
                        `<button class="btn-block" onclick="blockUserById('${user.id}')" title="‡¶¨‡ßç‡¶≤‡¶ï ‡¶ï‡¶∞‡ßÅ‡¶®">
                            <i class="fas fa-ban"></i>
                         </button>
                         <button class="btn-timer-block" onclick="quickTimerBlock('${user.id}')" title="‡¶ü‡¶æ‡¶á‡¶Æ‡¶æ‡¶∞ ‡¶¨‡ßç‡¶≤‡¶ï">
                            <i class="fas fa-clock"></i>
                         </button>` :
                        `<button class="btn-unblock" onclick="unblockUserById('${user.id}')" title="‡¶Ü‡¶®‡¶¨‡ßç‡¶≤‡¶ï ‡¶ï‡¶∞‡ßÅ‡¶®">
                            <i class="fas fa-check"></i>
                         </button>`
                    }
                </div>
            </div>
        `;
        userList.appendChild(userItem);
    });
    
    addLog(`‡¶á‡¶â‡¶ú‡¶æ‡¶∞ ‡¶≤‡¶ø‡¶∏‡ßç‡¶ü ‡¶≤‡ßã‡¶° ‡¶ï‡¶∞‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá (‡¶Æ‡ßã‡¶ü: ${users.length})`);
}

// Copy user ID
function copyUserId(userId) {
    navigator.clipboard.writeText(userId).then(() => {
        showCopyNotification(`‡¶á‡¶â‡¶ú‡¶æ‡¶∞ ID ‡¶ï‡¶™‡¶ø ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá: ${userId}`);
    }).catch(err => {
        // Fallback for older browsers
        const textArea = document.createElement('textarea');
        textArea.value = userId;
        document.body.appendChild(textArea);
        textArea.select();
        document.execCommand('copy');
        document.body.removeChild(textArea);
        showCopyNotification(`‡¶á‡¶â‡¶ú‡¶æ‡¶∞ ID ‡¶ï‡¶™‡¶ø ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá: ${userId}`);
    });
}

// Show copy notification
function showCopyNotification(message) {
    const notification = document.createElement('div');
    notification.className = 'copy-notification';
    notification.innerHTML = `<i class="fas fa-check-circle"></i> ${message}`;
    document.body.appendChild(notification);
    
    setTimeout(() => {
        if (document.body.contains(notification)) {
            document.body.removeChild(notification);
        }
    }, 2000);
}

// Quick timer block
function quickTimerBlock(userId) {
    const minutes = prompt(`${userId} ‡¶á‡¶â‡¶ú‡¶æ‡¶∞‡¶ï‡ßá ‡¶ï‡¶§ ‡¶Æ‡¶ø‡¶®‡¶ø‡¶ü‡ßá‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø ‡¶¨‡ßç‡¶≤‡¶ï ‡¶ï‡¶∞‡¶§‡ßá ‡¶ö‡¶æ‡¶®?`, "30");
    if (minutes && !isNaN(minutes) && minutes > 0) {
        timerBlockUserById(userId, parseInt(minutes));
    }
}

// Timer block user
function timerBlockUser() {
    const userId = document.getElementById('blockUserId').value.trim();
    const minutes = document.getElementById('blockMinutes').value;
    
    if (!userId) {
        showAlert('‚ùå ‡¶á‡¶â‡¶ú‡¶æ‡¶∞ ID ‡¶≤‡¶ø‡¶ñ‡ßÅ‡¶®!', 'error');
        return;
    }
    
    if (!minutes || isNaN(minutes) || minutes <= 0) {
        showAlert('‚ùå ‡¶∏‡¶†‡¶ø‡¶ï ‡¶Æ‡¶ø‡¶®‡¶ø‡¶ü ‡¶∏‡¶Ç‡¶ñ‡ßç‡¶Ø‡¶æ ‡¶≤‡¶ø‡¶ñ‡ßÅ‡¶®!', 'error');
        return;
    }
    
    timerBlockUserById(userId, parseInt(minutes));
    document.getElementById('blockMinutes').value = '';
}

// Timer block user by ID
function timerBlockUserById(userId, minutes) {
    const sharedData = getSharedData();
    
    sharedData.blocks = sharedData.blocks || {};
    sharedData.blocks[userId] = {
        type: 'temporary',
        blockTime: new Date().getTime(),
        duration: minutes,
        timestamp: new Date().toISOString()
    };
    
    saveSharedData(sharedData);
    
    showAlert(`‚úÖ ‡¶á‡¶â‡¶ú‡¶æ‡¶∞ ${userId} ${minutes} ‡¶Æ‡¶ø‡¶®‡¶ø‡¶ü‡ßá‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø ‡¶¨‡ßç‡¶≤‡¶ï ‡¶ï‡¶∞‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá!`, 'success');
    addLog(`‡¶á‡¶â‡¶ú‡¶æ‡¶∞ ‡¶ü‡¶æ‡¶á‡¶Æ‡¶æ‡¶∞ ‡¶¨‡ßç‡¶≤‡¶ï ‡¶ï‡¶∞‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá: ${userId} (${minutes} ‡¶Æ‡¶ø‡¶®‡¶ø‡¶ü)`);
    loadUsers();
    updateStatistics();
    document.getElementById('blockUserId').value = '';
}

// Block user
function blockUser() {
    const userId = document.getElementById('blockUserId').value.trim();
    blockUserById(userId);
}

// Block user by ID
function blockUserById(userId) {
    if (!userId) {
        showAlert('‚ùå ‡¶á‡¶â‡¶ú‡¶æ‡¶∞ ID ‡¶≤‡¶ø‡¶ñ‡ßÅ‡¶®!', 'error');
        return;
    }
    
    const sharedData = getSharedData();
    
    sharedData.blocks = sharedData.blocks || {};
    sharedData.blocks[userId] = {
        type: 'permanent',
        timestamp: new Date().toISOString()
    };
    
    saveSharedData(sharedData);
    
    showAlert(`‚úÖ ‡¶á‡¶â‡¶ú‡¶æ‡¶∞ ${userId} ‡¶™‡¶æ‡¶∞‡ßç‡¶Æ‡¶æ‡¶®‡ßá‡¶®‡ßç‡¶ü ‡¶¨‡ßç‡¶≤‡¶ï ‡¶ï‡¶∞‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá!`, 'success');
    addLog(`‡¶á‡¶â‡¶ú‡¶æ‡¶∞ ‡¶™‡¶æ‡¶∞‡ßç‡¶Æ‡¶æ‡¶®‡ßá‡¶®‡ßç‡¶ü ‡¶¨‡ßç‡¶≤‡¶ï ‡¶ï‡¶∞‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá: ${userId}`);
    loadUsers();
    updateStatistics();
    document.getElementById('blockUserId').value = '';
}

// Unblock user
function unblockUser() {
    const userId = document.getElementById('blockUserId').value.trim();
    unblockUserById(userId);
}

// Unblock user by ID
function unblockUserById(userId) {
    if (!userId) {
        showAlert('‚ùå ‡¶á‡¶â‡¶ú‡¶æ‡¶∞ ID ‡¶≤‡¶ø‡¶ñ‡ßÅ‡¶®!', 'error');
        return;
    }
    
    const sharedData = getSharedData();
    
    if (sharedData.blocks && sharedData.blocks[userId]) {
        delete sharedData.blocks[userId];
        saveSharedData(sharedData);
        
        showAlert(`‚úÖ ‡¶á‡¶â‡¶ú‡¶æ‡¶∞ ${userId} ‡¶Ü‡¶®‡¶¨‡ßç‡¶≤‡¶ï ‡¶ï‡¶∞‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá!`, 'success');
        addLog(`‡¶á‡¶â‡¶ú‡¶æ‡¶∞ ‡¶Ü‡¶®‡¶¨‡ßç‡¶≤‡¶ï ‡¶ï‡¶∞‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá: ${userId}`);
        loadUsers();
        updateStatistics();
        document.getElementById('blockUserId').value = '';
    } else {
        showAlert('‚ùå ‡¶á‡¶â‡¶ú‡¶æ‡¶∞ ‡¶ñ‡ßÅ‡¶Å‡¶ú‡ßá ‡¶™‡¶æ‡¶ì‡¶Ø‡¶º‡¶æ ‡¶Ø‡¶æ‡¶Ø‡¶º‡¶®‡¶ø!', 'error');
    }
}

// Block all users
function blockAllUsers() {
    if (!confirm('‚ö†Ô∏è ‡¶∏‡¶¨ ‡¶á‡¶â‡¶ú‡¶æ‡¶∞‡¶ï‡ßá ‡¶¨‡ßç‡¶≤‡¶ï ‡¶ï‡¶∞‡¶§‡ßá ‡¶ö‡¶æ‡¶®?')) return;
    
    const sharedData = getSharedData();
    sharedData.blocks = {};
    
    Object.keys(sharedData.users || {}).forEach(userId => {
        sharedData.blocks[userId] = {
            type: 'permanent',
            timestamp: new Date().toISOString()
        };
    });
    
    saveSharedData(sharedData);
    
    showAlert('‚úÖ ‡¶∏‡¶¨ ‡¶á‡¶â‡¶ú‡¶æ‡¶∞ ‡¶¨‡ßç‡¶≤‡¶ï ‡¶ï‡¶∞‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá!', 'success');
    addLog('‡¶∏‡¶¨ ‡¶á‡¶â‡¶ú‡¶æ‡¶∞ ‡¶¨‡ßç‡¶≤‡¶ï ‡¶ï‡¶∞‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá');
    loadUsers();
    updateStatistics();
}

// Unblock all users
function unblockAllUsers() {
    if (!confirm('‚ö†Ô∏è ‡¶∏‡¶¨ ‡¶á‡¶â‡¶ú‡¶æ‡¶∞‡¶ï‡ßá ‡¶Ü‡¶®‡¶¨‡ßç‡¶≤‡¶ï ‡¶ï‡¶∞‡¶§‡ßá ‡¶ö‡¶æ‡¶®?')) return;
    
    const sharedData = getSharedData();
    sharedData.blocks = {};
    saveSharedData(sharedData);
    
    showAlert('‚úÖ ‡¶∏‡¶¨ ‡¶á‡¶â‡¶ú‡¶æ‡¶∞ ‡¶Ü‡¶®‡¶¨‡ßç‡¶≤‡¶ï ‡¶ï‡¶∞‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá!', 'success');
    addLog('‡¶∏‡¶¨ ‡¶á‡¶â‡¶ú‡¶æ‡¶∞ ‡¶Ü‡¶®‡¶¨‡ßç‡¶≤‡¶ï ‡¶ï‡¶∞‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá');
    loadUsers();
    updateStatistics();
}

// Set maintenance message template
function setMaintenanceMessage(type) {
    let message = '';
    
    switch(type) {
        case '‡¶∏‡¶ø‡¶∏‡ßç‡¶ü‡ßá‡¶Æ ‡¶Ü‡¶™‡¶°‡ßá‡¶ü':
            message = 'üöß ‡¶∏‡¶ø‡¶∏‡ßç‡¶ü‡ßá‡¶Æ ‡¶Ü‡¶™‡¶°‡ßá‡¶ü ‡¶ö‡¶≤‡¶õ‡ßá‡•§ ‡¶ï‡¶ø‡¶õ‡ßÅ‡¶ï‡ßç‡¶∑‡¶£‡ßá‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø ‡¶∏‡¶æ‡¶∞‡ßç‡¶≠‡¶ø‡¶∏ ‡¶¨‡¶®‡ßç‡¶ß ‡¶•‡¶æ‡¶ï‡¶¨‡ßá‡•§ ‡¶Ü‡¶™‡¶°‡ßá‡¶ü ‡¶∂‡ßá‡¶∑ ‡¶π‡¶≤‡ßá ‡¶∏‡ßç‡¶¨‡¶Ø‡¶º‡¶Ç‡¶ï‡ßç‡¶∞‡¶ø‡¶Ø‡¶º‡¶≠‡¶æ‡¶¨‡ßá ‡¶ö‡¶æ‡¶≤‡ßÅ ‡¶π‡¶Ø‡¶º‡ßá ‡¶Ø‡¶æ‡¶¨‡ßá‡•§ ‡¶ß‡¶®‡ßç‡¶Ø‡¶¨‡¶æ‡¶¶‡•§';
            break;
        case '‡¶∏‡¶æ‡¶∞‡ßç‡¶≠‡¶ø‡¶∏ ‡¶¨‡¶®‡ßç‡¶ß':
            message = '‚õî ‡¶∏‡¶æ‡¶∞‡ßç‡¶≠‡¶ø‡¶∏ ‡¶∏‡¶æ‡¶Æ‡¶Ø‡¶º‡¶ø‡¶ï‡¶≠‡¶æ‡¶¨‡ßá ‡¶¨‡¶®‡ßç‡¶ß ‡¶∞‡¶Ø‡¶º‡ßá‡¶õ‡ßá‡•§ ‡¶¶‡ßç‡¶∞‡ßÅ‡¶§ ‡¶ö‡¶æ‡¶≤‡ßÅ ‡¶ï‡¶∞‡¶æ ‡¶π‡¶¨‡ßá‡•§ ‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶ß‡ßà‡¶∞‡ßç‡¶Ø‡ßá‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø ‡¶ß‡¶®‡ßç‡¶Ø‡¶¨‡¶æ‡¶¶‡•§';
            break;
        case '‡¶ï‡¶æ‡¶ú ‡¶ö‡¶≤‡¶õ‡ßá':
            message = 'üîß ‡¶∏‡¶ø‡¶∏‡ßç‡¶ü‡ßá‡¶Æ‡ßá ‡¶ï‡¶æ‡¶ú ‡¶ö‡¶≤‡¶õ‡ßá‡•§ ‡¶ï‡¶ø‡¶õ‡ßÅ‡¶ï‡ßç‡¶∑‡¶£‡ßá‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø ‡¶∏‡¶æ‡¶∞‡ßç‡¶≠‡¶ø‡¶∏ ‡¶¨‡¶®‡ßç‡¶ß ‡¶•‡¶æ‡¶ï‡¶¨‡ßá‡•§ ‡¶ï‡¶æ‡¶ú ‡¶∂‡ßá‡¶∑ ‡¶π‡¶≤‡ßá ‡¶∏‡ßç‡¶¨‡¶Ø‡¶º‡¶Ç‡¶ï‡ßç‡¶∞‡¶ø‡¶Ø‡¶º‡¶≠‡¶æ‡¶¨‡ßá ‡¶ö‡¶æ‡¶≤‡ßÅ ‡¶π‡¶Ø‡¶º‡ßá ‡¶Ø‡¶æ‡¶¨‡ßá‡•§';
            break;
        case '‡¶Ö‡¶≤‡ßç‡¶™ ‡¶∏‡¶Æ‡¶Ø‡¶º‡ßá‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø ‡¶¨‡¶®‡ßç‡¶ß':
            message = '‚è≥ ‡¶∏‡¶æ‡¶∞‡ßç‡¶≠‡¶ø‡¶∏ ‡¶Ö‡¶≤‡ßç‡¶™ ‡¶∏‡¶Æ‡¶Ø‡¶º‡ßá‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø ‡¶¨‡¶®‡ßç‡¶ß ‡¶∞‡¶Ø‡¶º‡ßá‡¶õ‡ßá‡•§ ‡¶¶‡ßç‡¶∞‡ßÅ‡¶§ ‡¶ö‡¶æ‡¶≤‡ßÅ ‡¶ï‡¶∞‡¶æ ‡¶π‡¶¨‡ßá‡•§ ‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶∏‡¶π‡¶Ø‡ßã‡¶ó‡¶ø‡¶§‡¶æ‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø ‡¶ß‡¶®‡ßç‡¶Ø‡¶¨‡¶æ‡¶¶‡•§';
            break;
    }
    
    document.getElementById('broadcastMessage').value = message;
}

// Send broadcast message
function sendBroadcastMessage() {
    const message = document.getElementById('broadcastMessage').value.trim();
    if (!message) {
        showAlert('‚ùå ‡¶Æ‡ßá‡¶∏‡ßá‡¶ú ‡¶≤‡¶ø‡¶ñ‡ßÅ‡¶®!', 'error');
        return;
    }
    
    const sharedData = getSharedData();
    
    sharedData.messages = sharedData.messages || {};
    sharedData.messages['broadcast'] = sharedData.messages['broadcast'] || [];
    sharedData.messages['broadcast'].push({
        message: message,
        timestamp: new Date().toISOString(),
        type: 'broadcast'
    });
    
    saveSharedData(sharedData);
    
    showAlert(`‚úÖ ‡¶¨‡ßç‡¶∞‡¶°‡¶ï‡¶æ‡¶∏‡ßç‡¶ü ‡¶Æ‡ßá‡¶∏‡ßá‡¶ú ‡¶™‡¶æ‡¶†‡¶æ‡¶®‡ßã ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá!`, 'success');
    addLog(`‡¶¨‡ßç‡¶∞‡¶°‡¶ï‡¶æ‡¶∏‡ßç‡¶ü ‡¶Æ‡ßá‡¶∏‡ßá‡¶ú ‡¶™‡¶æ‡¶†‡¶æ‡¶®‡ßã ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá: "${message}"`);
    updateBroadcastStatus();
    
    document.getElementById('broadcastMessage').value = '';
}

// Send private message
function sendPrivateMessage() {
    const userId = document.getElementById('privateUserId').value.trim();
    const message = document.getElementById('privateMessage').value.trim();
    
    if (!userId || !message) {
        showAlert('‚ùå ‡¶á‡¶â‡¶ú‡¶æ‡¶∞ ID ‡¶è‡¶¨‡¶Ç ‡¶Æ‡ßá‡¶∏‡ßá‡¶ú ‡¶≤‡¶ø‡¶ñ‡ßÅ‡¶®!', 'error');
        return;
    }
    
    const sharedData = getSharedData();
    
    // Check if user exists
    if (!sharedData.users || !sharedData.users[userId]) {
        showAlert('‚ùå ‡¶á‡¶â‡¶ú‡¶æ‡¶∞ ID ‡¶∏‡¶†‡¶ø‡¶ï ‡¶®‡ßü!', 'error');
        return;
    }
    
    sharedData.messages = sharedData.messages || {};
    sharedData.messages[userId] = sharedData.messages[userId] || [];
    sharedData.messages[userId].push({
        message: message,
        timestamp: new Date().toISOString(),
        read: false
    });
    
    saveSharedData(sharedData);
    
    showAlert(`‚úÖ ‡¶Æ‡ßá‡¶∏‡ßá‡¶ú ‡¶á‡¶â‡¶ú‡¶æ‡¶∞ ${userId} ‡¶ï‡ßá ‡¶™‡¶æ‡¶†‡¶æ‡¶®‡ßã ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá!`, 'success');
    addLog(`‡¶™‡ßç‡¶∞‡¶æ‡¶á‡¶≠‡ßá‡¶ü ‡¶Æ‡ßá‡¶∏‡ßá‡¶ú ‡¶™‡¶æ‡¶†‡¶æ‡¶®‡ßã ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá: ${userId} - "${message}"`);
    
    document.getElementById('privateUserId').value = '';
    document.getElementById('privateMessage').value = '';
}

// Quick message to user
function quickMessage(userId) {
    const message = prompt(`‡¶á‡¶â‡¶ú‡¶æ‡¶∞ ${userId} ‡¶ï‡ßá ‡¶Æ‡ßá‡¶∏‡ßá‡¶ú ‡¶≤‡¶ø‡¶ñ‡ßÅ‡¶®:`);
    if (message) {
        const sharedData = getSharedData();
        
        sharedData.messages = sharedData.messages || {};
        sharedData.messages[userId] = sharedData.messages[userId] || [];
        sharedData.messages[userId].push({
            message: message,
            timestamp: new Date().toISOString(),
            read: false
        });
        
        saveSharedData(sharedData);
        showAlert(`‚úÖ ‡¶Æ‡ßá‡¶∏‡ßá‡¶ú ‡¶™‡¶æ‡¶†‡¶æ‡¶®‡ßã ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá!`, 'success');
        addLog(`‡¶¶‡ßç‡¶∞‡ßÅ‡¶§ ‡¶Æ‡ßá‡¶∏‡ßá‡¶ú ‡¶™‡¶æ‡¶†‡¶æ‡¶®‡ßã ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá: ${userId} - "${message}"`);
    }
}

// Log management
function addLog(message) {
    const logEntry = {
        time: new Date().toLocaleString(),
        message: message
    };
    
    adminLogs.unshift(logEntry);
    if (adminLogs.length > 100) {
        adminLogs = adminLogs.slice(0, 100);
    }
    
    localStorage.setItem(ADMIN_LOGS_KEY, JSON.stringify(adminLogs));
    updateLogDisplay();
}

function updateLogDisplay() {
    const logContainer = document.getElementById('logContainer');
    logContainer.innerHTML = '';
    
    adminLogs.forEach(log => {
        const logEntry = document.createElement('div');
        logEntry.className = 'log-entry';
        logEntry.innerHTML = `<span class="log-time">[${log.time}]</span> ${log.message}`;
        logContainer.appendChild(logEntry);
    });
}

function clearLogs() {
    if (!confirm('‚ö†Ô∏è ‡¶∏‡¶¨ ‡¶≤‡¶ó ‡¶°‡¶ø‡¶≤‡¶ø‡¶ü ‡¶ï‡¶∞‡¶§‡ßá ‡¶ö‡¶æ‡¶®?')) return;
    
    adminLogs = [];
    localStorage.setItem(ADMIN_LOGS_KEY, JSON.stringify(adminLogs));
    updateLogDisplay();
    showAlert('‚úÖ ‡¶∏‡¶¨ ‡¶≤‡¶ó ‡¶ï‡ßç‡¶≤‡¶ø‡¶Ø‡¶º‡¶æ‡¶∞ ‡¶ï‡¶∞‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá!', 'success');
}

// Utility functions
function showAlert(message, type) {
    const alertBox = document.getElementById('alertBox');
    alertBox.className = `alert alert-${type}`;
    alertBox.textContent = message;
    setTimeout(() => {
        alertBox.textContent = '';
        alertBox.className = 'alert';
    }, 5000);
}

// Auto-refresh system
function refreshData() {
    updateStatistics();
    updateBroadcastStatus();
}

// Initialize on load
document.addEventListener('DOMContentLoaded', function() {
    refreshData();
    loadUsers();
    updateLogDisplay();
    
    // Auto-refresh every 3 seconds
    setInterval(refreshData, 3000);
    
    // Auto-refresh user list every 5 seconds
    setInterval(loadUsers, 5000);
    
    // Update real-time indicator
    setInterval(() => {
        const indicator = document.getElementById('realTimeIndicator');
        indicator.style.animation = 'none';
        setTimeout(() => {
            indicator.style.animation = 'pulse 2s infinite';
        }, 10);
    }, 3000);
});

// Search functionality
document.getElementById('searchUser').addEventListener('input', loadUsers);

// Keyboard shortcuts
document.addEventListener('keydown', function(e) {
    // Ctrl + R to refresh
    if (e.ctrlKey && e.key === 'r') {
        e.preventDefault();
        loadUsers();
        refreshData();
        showAlert('üîÑ ‡¶°‡ßá‡¶ü‡¶æ ‡¶∞‡¶ø‡¶´‡ßç‡¶∞‡ßá‡¶∂ ‡¶ï‡¶∞‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá!', 'info');
    }
});
</script>
</body>
</html>
